{
  "hash": "40df9603472a64dde545f5ed10105a8b",
  "result": {
    "markdown": "---\ntitle: \"G-computation in NZAVS Studies\"\nexecute:\n  warning: false\n  echo: false\ndraft: false\ncitation:\n  url: https://go-bayes.github.io/b-causal/\ndate: 2022-11-05\nimage: \"gc.png\"\ndate-format: short\nbibliography: references.bib\ncategories: \n  - Causal Inference\n  - NZAVS\n  - Methods\n---\n\n::: {.cell}\n\n:::\n\n\n## Causal inference\n\nSuppose we want to infer whether a dichotomous exposure has a causal effect. We must answer three questions:\n\n1.  What would happen with exposure?\n2.  What would happen with no exposure?\n3.  Do these potential outcomes differ?\n\nConsider a binary exposure $A$ with two levels, $A = 0$ and $A=1$ and a continuous outcome $Y$.  Estimating the causal effect of $A$ on outcome $Y$ requires contrasting two states of the world.  The state of the the world $Y^{a=1}$ when, perhaps contrary to fact, $A$ is set to $1$ and the state of the world $Y^{a=0}$ when, perhaps contrary to fact, $A$ is set to $0$. We say that $A$ affects $Y$  when the quantities\\$Y\\^{a=1} - Y\\^{a=0} \\\\neq 0\\$ [@hernan2023] .  \n\n### The fundamental problem of causal inference.\n\nAt any given time, for any individual, at most only one level of the exposure $A$ may be realised. That is, $Y^{a=1}$ and $Y^{a=0}$ are never simultaneously observed in any individual.  As such, individual-level causal effects are not typically identified in the data. This is referred to as \"the fundamental problem of causal inference \" [@rubin1976; @gelman2020a]. $Y^{a=1}$ and $Y^{a=0}$ are therefore called \"potential\" or \"counterfactual\" outcomes.\n\nAlthough we cannot generally observed causal effects in any individual, when certain assumptions are satisfied, we may identify the average or marginal causal effect at the level of a population.  We say there is an average or marginal causal effect if the difference of the averages of those who are exposed and are not exposed does not equal zero:  $E(Y^{a=1}) - E(Y^{a=0})\\neq 0$ . Because the difference of the means is equivalent to the mean of the differences, we may equivalently say there is an marginal causal effect if $E(Y^{a=1} - Y^{a=0})\\neq 0$ [@hernan2023]. \\^\\[Our example uses a binary exposure but we may contrast the counterfactual outcomes for two levels of a continuous exposure. However, to do this wee must state the levels of exposure at which we seek comparisons.\\] \n\nCritically, to ensure valid inference, the potential outcomes must be (conditionally) independent of the exposure: \n\n$$Y^a  \\perp\\!\\!\\!\\perp A|L$$\n\n**Or equivalently:**\n\n$$A \\perp\\!\\!\\!\\perp Y^a |L$$\n\nOutside of controlled experiments we cannot generally ensure this conditional independence. For this reason, we use sensitivity analysis, such as the *E-value* [@vanderweele2020]\n\n## G-computation (or regression standardisation)\n\nTo consistently estimate a causal association we must infer the average outcomes for the entire population were it subject to different levels of the exposure variable $A = a$ and $A=a*$. \n\n$$ATE = E[Y^{a*}] - E[Y^a] = $$\n\n$$\\sum_l E[Y|A=a*, L=l]\\Pr[L=l] - \\sum_c E[Y|A=a, L=l]\\Pr[L=l]$$\n\nWe need not estimate $\\Pr(L = l)$. Rather obtain the weighted mean for the distribution of the confounders in the data by taking the double expectation: [@hernan2023, p.166].\n\n$$ATE = E[E(Y|A = a, \\boldsymbol{L}) - E(Y|A = a*, \\boldsymbol{L})]$$\n\nTo obtain marginal contrasts for the expected outcomes for the entire population we use the stdReg package in R [@sjölander2016] \n\n## The steps for G-computation\n\n1.  First we fit a regression for each outcome on the exposure $A\\_{t0}$ and baseline covariates$\\boldsymbol{L} = (L_1, L_2,L_3 \\dots L_n)$. To avoid implausible assumptions of linearity we model the relationship between the exposure each of the potential outcomes of interest using a cubic spline.  We include in the set of baseline confounders $\\boldsymbol{L}$ the baseline measure of the exposure as well as the baseline response (or responses):\n\n$$\\{A\\_{t-1}, \\boldsymbol{Y_{t-1}} = (Y_{1, t-1}, Y_{2, t-1}, Y_{3, t-1}\\dots Y_{n, t-1})\\} \\subset \\boldsymbol{L}$$  \n\nThis gives us\n\n$$E(Y|A, \\boldsymbol{L})$$\n\n2.  Second, we use the model in (1) to predict the values of a potential outcome $Y^{a}$ by setting the exposure to the value $A = a$.\n\nThis gives us\n\n$$\\hat{E}(Y|A = a, \\boldsymbol{L})$$\n\n3.  Third, we use the model in (1) to predict the values of a different potential outcome $Y^{a*}$by setting the exposure to a different value of $A =a^{\\star}$.\n\nThis gives us \n\n$$\\hat{E}(Y|A = a*,\\boldsymbol{L})$$\n\n4.  Forth we obtain the focal contrast as the expected difference in the expected average outcomes when exposure at levels $a*$ and $a$. Where outcomes are continuous we calculate both mean of $Y^a$ and the mean of  $Y^{a*}$ and then obtain their difference.  This gives us: \n\n$$\\hat{ATE} = \\hat{E}[\\hat{E}(Y|A = a, \\boldsymbol{L}) - \\hat{E}(Y|A = a*, \\boldsymbol{L})]$$\n\n5.  Where outcomes are binary, we calculate the causal risk ratio in moving between the different levels of A. Where binary outcomes are more common than 10% we use a log-normal model to calculate a causal rate ratio [@vanderweele2020]. \n\n6.  The stdReg package in R calculates standard errors using the Delta method from which we construct confidence intervals under asymptotic assumptions[@sjölander2016]. Additionally, we pool uncertainty arising from the multiple imputation procedure by employing Rubin's Rules. \n\n\n## Applications\n\nSee upcoming \"Outcome-wide science\" reports for illustrations of how we apply G-computation to NZAVS studies.\n\n### Acknowledgements\n\nWe are grateful to Arvid Sjölander for his help in modifying his stdReg package in R to enable G-computation with multiply-imputed datasets.\n\nFor a simple visual guide to G-computation see [Kat Hoffman's blog](https://www.khstats.com/art/illustrations_viz.html)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}