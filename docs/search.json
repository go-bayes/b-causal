[
  {
    "objectID": "temp/post-with-code/index.html",
    "href": "temp/post-with-code/index.html",
    "title": "Post With Code",
    "section": "",
    "text": "This is a post with executable code.\n\n1 + 1\n\n[1] 2\n\n\n\n\n\nReuseCC BY-NC-SA"
  },
  {
    "objectID": "posts/welcome/index.html#me",
    "href": "posts/welcome/index.html#me",
    "title": "Welcome to the B-causal Lab",
    "section": "Me",
    "text": "Me\nHello. My name is Joseph Bulbulia. I am a Professor of Psychology at Victoria University of Wellington, a member of the New Zealand Attitudes and Values Senior Leadership Team, a research associate at the Max Plank Institute for the Science of Human History, and an adjunct professor in Psychology at the University of Canterbury.\nA CV with links to my publications can be found by clicking the “CV” button here"
  },
  {
    "objectID": "posts/welcome/index.html#purpose",
    "href": "posts/welcome/index.html#purpose",
    "title": "Welcome to the B-causal Lab",
    "section": "Purpose",
    "text": "Purpose\nThe purpose of this site is to convey brief research reports to the public. The reports relate to substantive research from the the New Zealand Attitudes and Values Study and to methods for causal inference using panel data."
  },
  {
    "objectID": "posts/welcome/index.html#contact",
    "href": "posts/welcome/index.html#contact",
    "title": "Welcome to the B-causal Lab",
    "section": "Contact",
    "text": "Contact\nMy email address for contact is: joseph.bulbulia@vuw.ac.nz"
  },
  {
    "objectID": "posts/nzavs/index.html",
    "href": "posts/nzavs/index.html",
    "title": "The New Zealand Attitudes and Values Study",
    "section": "",
    "text": "Show the code\n# https://quarto-dev.github.io/quarto-gallery/page-layout/tufte.html\n# fig.width=12, fig.height=10, fig.cap=\"Sampling from the electoral rol combines with repeated measures within the same people across New Zealand's social diversity to enable robust inference about stability and change in attitudes and values across New Zealand over time.\", layout = \"l-body-outset\", cache = TRUE\n\n# read data\ndat <- readRDS(pull_path)\n\ndatrep <- dat %>%\n  dplyr::mutate(timeline = make_date(year = 2009, month = 6, day = 30) + TSCORE) %>%\n  count(day = floor_date(timeline, \"day\")) %>%\n  dplyr::mutate(Year = factor(ifelse(\n    day < \"2010-01-01\",\n    2009,\n    ifelse(\n      day < \"2011-01-01\",\n      2010,\n      ifelse(\n        day < \"2012-01-01\",\n        2011,\n        ifelse(\n          day < \"2013-01-01\",\n          2012,\n          ifelse(\n            day < \"2014-01-01\",\n            2013,\n            ifelse(\n              day < \"2015-01-01\",\n              2014,\n              ifelse(\n                day < \"2016-01-01\",\n                2015,\n                ifelse(\n                  day < \"2017-01-01\",\n                  2016,\n                  ifelse(\n                    day < \"2018-01-01\",\n                    2017,\n                    ifelse(day < \"2019-01-01\", 2018,\n                           ifelse(day < \"2020-01-01\", 2019, \n                                   ifelse(day < \"2021-01-01\", 2020, \n                                             ifelse(day < \"2022-01-01\", 2021,2022))\n                  )\n                )\n              )\n            )\n          )\n        )\n      )\n    )\n  ))) ))%>%\n  arrange(day)\n\n# create date lines\nceq <- as.Date(\"2011-02-22\")\nkeq <- as.Date(\"2016-11-14\")\nter <- as.Date(\"2019-03-15\")\ncov <- as.Date(\"2020-03-24\")\n\n# get number for dates\nceqD <- which(datrep$day %in% ceq)\nkeqD <- which(datrep$day %in% keq)\nterD <- which(datrep$day %in% ter)\ncovD <- which(datrep$day %in% cov)\n\n\n# create dates\n\nd1 <- as.numeric(datrep$day[ceqD])\nd2 <- as.numeric(datrep$day[keqD])\nd3 <- as.numeric(datrep$day[terD])\nd4 <- as.numeric(datrep$day[covD])\n\n# create break points\ncuts <-\n  data.frame(\n    Big_Events = c(\n      \"Christchurch Earthquake\",\n      \"Kaikoura Earthquake\",\n      \"Mosque Attacks\",\n      \"Stringent COVID-19 LockDown\"\n    ),\n    vals = c(d1, d2, d3, d4),\n    stringsAsFactors = FALSE\n  )\n\nggplot2::ggplot(datrep, aes(day, n)) +\n  geom_col(aes(fill = Year)) + scale_x_date(date_labels = \"%b/%Y\")  +\n  geom_vline(\n    mapping = aes(xintercept = vals,\n                  colour = Big_Events),\n    data = cuts,\n    linetype = \"dashed\",\n    show.legend = TRUE\n  )  +\nlabs(title = \"New Zealand Attitudes and Values Study Daily Response Counts\\n Years 2009-2020; N = 61,535\",\n     x = \"NZAVS daily counts\", y = \"Count of Responses\") + theme_classic()  +  scale_fill_viridis_d() + theme(legend.position = \"top\")"
  },
  {
    "objectID": "posts/nzavs/index.html#where-can-i-go-for-futher-information",
    "href": "posts/nzavs/index.html#where-can-i-go-for-futher-information",
    "title": "The New Zealand Attitudes and Values Study",
    "section": "Where can I go for futher information?",
    "text": "Where can I go for futher information?\nThe NZAVS website is maintained by Prof Chris Sibley.Link ## Link to data dictionary and questions\nLink to full data dictionary\nLink to questions only"
  },
  {
    "objectID": "posts/nzavsnetwork/nzavs_network.html",
    "href": "posts/nzavsnetwork/nzavs_network.html",
    "title": "NZAVS Retention Graph",
    "section": "",
    "text": "A key challenge in longitudional research is participant retention. This graph presents sample retention for the New Zealand Attitudes and Values Study (NZAVS). Figure 1 presents the sample frames within a single graph. Figure 2 presents the sample frames separately.\nFor more information about the NZAVS see: here and here\n\n\nShow the code\n# First we import the data, and create an indicator for measured/lost/withdrawn.\nlibrary(\"ggalluvial\") # alluvial graphs\n\n# data sent by Chris Sibley Aug 2021\n\nsampling_data <-\n  haven::read_sav(here::here(\"data\", \"GraphData2.sav\"))\n\n# remove SPSS labels\nsampling_data <- haven::zap_formats(sampling_data)\nsampling_data <- haven::zap_label(sampling_data)\nsampling_data <- haven::zap_widths(sampling_data)\nsampling_data <- haven::zap_labels(sampling_data)\n\n# rename Id variable\nsampling_data <- sampling_data %>%\n  rename(Id = Questionnaire.Num)\n\n## transform data into long form, required for ggalluvial, and rename the waves\ninner_join(\n  sampling_data  %>%\n    dplyr::select(c(\n      Id,\n      c(\n        'T01',\n        \"T02\",\n        'T03',\n        \"T035\",\n        \"T04\",\n        'T05',\n        \"T06\",\n        'T07',\n        \"T08\",\n        \"T09\",\n        \"T10\",\n        \"T11\",\n        \"T12\"\n      )\n    )) %>%      #~~~~ Left side = date component ~~~~~~~~\n    gather(Wave, YearMeasured, -Id) %>%  #~ long form = 1 row per prod per seq   ~\n    mutate(\n      Wave = recode_factor(\n        Wave,\n        T01 = \"2009\",\n        T02 = \"2010\",\n        T03 = \"2011\",\n        T035 = \"2011.5\",\n        T04  = \"2012\",\n        T05 = \"2013\",\n        T06 = \"2014\",\n        T07 = \"2015\",\n        T08 = \"2016\",\n        T09 = \"2017\",\n        T10 = \"2018\",\n        T11 = \"2019\",\n        T12 = \"2020\"\n      )\n    ) %>%\n    arrange(Id),\n  sampling_data %>%\n    dplyr::select(c(Id, starts_with('SampleOriginYear'))) %>%\n    arrange(Id),\n) -> sdf\n\n# define sample origin year\nsdf <- sdf %>%\n  mutate(SampleOriginYear = SampleOriginYear + 2008)\n\n#  Make sample frame into a factor\nsdf$SampleOriginYear <- as.factor(sdf$SampleOriginYear)\n\n# Created levels for \"missing\", \"not yet measured\" and \"deceased\"\n# then filter \"not yet measured\"\n\nsdf.0 <- sdf %>%\n  mutate(Wave = as.numeric(as.character(Wave))) %>%\n  arrange(Wave, Id) %>%\n  group_by(Id) %>%\n  mutate(first = {\n    YearMeasured == 1\n  } %>% {\n    . * !duplicated(.)\n  }) %>%\n  mutate(\n    value_tmp = if_else(first == 1, Wave, NA_real_),\n    firstwave  = mean(value_tmp, na.rm = TRUE) # this is a hack, but works\n  ) %>%\n  mutate(state  = ifelse(\n    YearMeasured == -1,\n    \"deceased\",\n    ifelse(\n      YearMeasured == 0 & Wave < firstwave,\n      \"notyetmeasured\",\n      ifelse(YearMeasured == 0 &\n               Wave > firstwave, \"missing\",\n             \"measured\")\n    )\n  )) %>%\n  dplyr::mutate(Wave = as.factor(Wave)) %>% # return Wave to a factor\n  dplyr::select(Wave, Id, state, YearMeasured, SampleOriginYear) %>%\n  dplyr::filter(state != \"notyetmeasured\") %>%\n  droplevels() %>%\n  arrange(Id, Wave)\n\n# This is to create a \"recovered\" state. Not used but could be useful for modelling recovery:\nsdf.01 <- sdf.0 %>%\n  group_by(Id) %>%\n  mutate(lag_state = dplyr::lag(state, n = 1, default = \"init\"))\n\nsdf.1 <- sdf.01 %>%\n  group_by(Id, Wave) %>%\n  mutate(recovered = ifelse(lag_state == \"missing\" &\n                              state == \"measured\", \"recovered\", state))\n\n\n# We need to back fill the missing values for our alluvial graph.\n# This is OK because a participants original sampling frame does not change.\n\nssdf0 <- sdf.1 %>%  # Fill missing values for Sample.Frame\n  arrange(Id) %>%\n  group_by(Id) %>%\n  fill(SampleOriginYear)  %>%\n  ungroup()\n\n# now we create the \"state_frame\" variable\ntf <- ssdf0 %>%\n  mutate(SampleOriginYear = as.character(SampleOriginYear))\n\nssdf <- tf %>%\n  mutate(state_frame = ifelse(\n    state == \"missing\",\n    \"missing\",\n    ifelse(state == \"deceased\", \"deceased\",\n           SampleOriginYear)\n  ))\nssdf.0 <- ssdf %>%\n  mutate(state_frame = factor(state_frame))\n\n# next we order the levels of the factor to create a pretty graph\nssdf.01 <- ssdf.0 %>%\n  mutate(state_frame = forcats::fct_relevel(\n    state_frame,\n    c(\n      \"2009\",\n      \"2010\",\n      \"2011\",\n      \"2011.5\",\n      \"2012\",\n      \"2013\",\n      \"2014\",\n      \"2015\",\n      \"2016\",\n      \"2017\",\n      \"2018\",\n      \"2019\",\n      \"2020\",\n      \"missing\",\n      \"deceased\"\n    )\n  )) %>%\n  rename(Recovered = recovered) # for pretty table"
  },
  {
    "objectID": "posts/nzavsnetwork/nzavs_network.html#alluvial-graph-nzavs-sample-retention-by-wave-faceted-by-sample-frame",
    "href": "posts/nzavsnetwork/nzavs_network.html#alluvial-graph-nzavs-sample-retention-by-wave-faceted-by-sample-frame",
    "title": "NZAVS Retention Graph",
    "section": "Alluvial graph: NZAVS sample retention by wave, faceted by sample frame",
    "text": "Alluvial graph: NZAVS sample retention by wave, faceted by sample frame\n\n\nShow the code\n# prepare data for graph \ndatsSF <- ssdf.01 %>%\n  group_by(Wave, state_frame, Id) %>%\n  summarise(n = n())\n\n# Graph\n\np <- ggplot(\n  datsSF,\n  aes(\n    x = Wave,\n    stratum = state_frame,\n    alluvium = Id,\n    y = n,\n    fill = state_frame,\n    label = state_frame\n  )\n) +\n  geom_flow() +\n  geom_stratum(alpha = .5) +\n  geom_text(stat = \"stratum\", size = 2) +\n  guides(color = guide_legend(override.aes = list(size = 20))) +\n  scale_x_discrete(position = 'top', expand = c(0, 0)) +\n  scale_y_reverse(\n    expand = c(0.001, 0.001),\n    minor_breaks = seq(0, 70000, by = 1000),\n    breaks = seq(0, 70000, by = 5000)\n  ) +\n  scale_fill_viridis_d(option = \"turbo\") +\n  ggtitle(\"NZAVS alluvial retention graph: waves 2009-2020\")  +\n  theme_bw() +   \n  theme(legend.justification = \"top\") +\n  theme(legend.title = element_blank())  # remove legend title\n\n# to save file in your directory at correct resolution, uncomment below\n# file <- here(\"figs\", paste(\"alluvial_highres_turbo_BW\", \".png\", sep = \"\"))\n\np\n\nggsave(\n  p,\n  path = here::here(here::here(\"posts\", \"nzavsnetwork\" )),\n  width = 8,\n  height = 4.5,\n  units = \"in\",\n  filename = \"a_plot.png\",\n  device = \"png\",\n  scale = 1,\n  dpi = 100,\n  limitsize = TRUE\n)\n\n\n\n\n\nFigure 1: NZAVS alluvial retention graph: waves 2009-2020.\n\n\n\n\n\n\nShow the code\n# prepare data\ndatsSS <- ssdf.01 %>%\n  group_by(Wave, state, SampleOriginYear, Id) %>%\n  summarise(n = n())\n\n\n# Graph\nggplot(datsSS,\n       aes(\n         x = Wave,\n         stratum = state,\n         alluvium = Id,\n         y = n,\n         fill = state,\n         label = state\n       )) +\n  scale_x_discrete(expand = c(.1, .1)) +\n  geom_flow() +\n  geom_stratum(alpha = .5) +\n  geom_text(stat = \"stratum\", size = 2) +\n  theme(legend.position = \"none\") +\n  scale_x_discrete(position = 'top') +\n  scale_y_reverse(\n    expand = c(0.001, 0.001),\n    minor_breaks = seq(0, 70000, by = 1000),\n    breaks = seq(0, 70000, by = 1000)\n  ) +\n  facet_grid(SampleOriginYear ~ ., scales = \"free\", space = \"free\") +\n  theme(strip.text.y = element_text(angle = 0)) +\n  scale_fill_viridis_d(option = \"viridis\") +\n  # scale_fill_viridis_d(option=\"turbo\") + # another option\n  ggtitle(\"NZAVS alluvial retention graph: waves 2009-2020\",\n          subtitle  = \"Facets are sample frames\")  +\n  theme_bw() +\n  theme(legend.title = element_blank())  # remove legend title\n\n\n\n\n\nFigure 2: NZAVS alluvial retention graph: facets are sample frames."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "b-causal-lab brief reports",
    "section": "",
    "text": "NZAVS Retention Graph\n\n\n\n\n\n\n\nbackground\n\n\n\n\n\n\n\n\n\n\n\nNov 4, 2022\n\n\nJoseph Bulbulia, Joseph Bulbulia\n\n\n\n\n\n\n  \n\n\n\n\nThe New Zealand Attitudes and Values Study\n\n\n\n\n\n\n\nbackground\n\n\n\n\n\n\n\n\n\n\n\nNov 2, 2022\n\n\nJoseph Bulbulia\n\n\n\n\n\n\n  \n\n\n\n\nWelcome to the B-causal Lab\n\n\n\n\n\n\n\nbackground\n\n\n\n\n\n\n\n\n\n\n\nOct 30, 2022\n\n\nJoseph Bulbulia\n\n\n\n\n\n\nNo matching items\n\nReuseCC BY-NC-SA"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "The purpose of this site is to convey research to a broader public."
  },
  {
    "objectID": "about.html#contact",
    "href": "about.html#contact",
    "title": "About",
    "section": "Contact",
    "text": "Contact\nMy email address for contact is: joseph.bulbulia@vuw.ac.nz"
  }
]