[
  {
    "objectID": "temp/post-with-code/index.html",
    "href": "temp/post-with-code/index.html",
    "title": "Post With Code",
    "section": "",
    "text": "This is a post with executable code.\n\n1 + 1\n\n[1] 2\n\n\n\n\n\nReuseCC BY-NC-SA"
  },
  {
    "objectID": "posts/g-computation/g-computation.html#causal-inference",
    "href": "posts/g-computation/g-computation.html#causal-inference",
    "title": "Parametric G-computation in NZAVS Studies",
    "section": "Causal inference",
    "text": "Causal inference\nSuppose we want to infer whether a dichotomous exposure has a causal effect. We must answer three questions:\n\nWhat would happen with exposure?\nWhat would happen with no exposure?\nDo these potential outcomes differ?\n\nConsider a binary exposure \\(A\\) with two levels, \\(A = 0\\) and \\(A=1\\) and a continuous outcome \\(Y\\).  Estimating the causal effect of \\(A\\) on outcome \\(Y\\) requires contrasting two states of the world.  The state of the the world \\(Y^{a=1}\\) when, perhaps contrary to fact, \\(A\\) is set to \\(1\\) and the state of the world \\(Y^{a=0}\\) when, perhaps contrary to fact, \\(A\\) is set to \\(0\\). We say that \\(A\\) affects \\(Y\\)  when the quantities$Y^{a=1} - Y^{a=0} \\neq 0$ (Hernan and Robins 2023) .  \n\nThe fundamental problem of causal inference.\nAt any given time, for any individual, at most only one level of the exposure \\(A\\) may be realised. That is, \\(Y^{a=1}\\) and \\(Y^{a=0}\\) are never simultaneously observed in any individual.  As such, individual-level causal effects are not typically identified in the data. This is referred to as “the fundamental problem of causal inference” (Rubin 1976; Gelman, Hill, and Vehtari 2020). \\(Y^{a=1}\\) and \\(Y^{a=0}\\) are therefore called “potential” or “counterfactual” outcomes.\nAlthough we cannot generally observed causal effects in any individual, when certain assumptions are satisfied, we may identify the average or marginal causal effect at the level of a population.  We say there is an average or marginal causal effect if the difference of the averages of those who are exposed and are not exposed does not equal zero:  \\(E(Y^{a=1}) - E(Y^{a=0})\\neq 0\\) . Because the difference of the means is equivalent to the mean of the differences, we may equivalently say there is an marginal causal effect if \\(E(Y^{a=1} - Y^{a=0})\\neq 0\\) (Hernan and Robins 2023). ^[Our example uses a binary exposure but we may contrast the counterfactual outcomes for two levels of a continuous exposure. However, to do this wee must state the levels of exposure at which we seek comparisons.] \nCritically, to ensure valid inference, the potential outcomes must be (conditionally) independent of the exposure: \n\\[Y^a  \\perp\\!\\!\\!\\perp A|L\\]\nOr equivalently:\n\\[A \\perp\\!\\!\\!\\perp Y^a |L\\]\nOutside of controlled experiments we cannot generally ensure this conditional independence. For this reason, we use sensitivity analysis, such as the E-value (VanderWeele, Mathur, and Chen 2020)"
  },
  {
    "objectID": "posts/g-computation/g-computation.html#parametric-g-computation-or-regression-standardisation",
    "href": "posts/g-computation/g-computation.html#parametric-g-computation-or-regression-standardisation",
    "title": "Parametric G-computation in NZAVS Studies",
    "section": "Parametric G-computation (or regression standardisation)",
    "text": "Parametric G-computation (or regression standardisation)\nTo consistently estimate a causal association we must infer the average outcomes for the entire population were it subject to different levels of the exposure variable \\(A = a\\) and \\(A=a*\\). \n\\[ATE = E[Y^{a*}] - E[Y^a] = \\]\n\\[\\sum_l E[Y|A=a*, L=l]\\Pr[L=l] - \\sum_c E[Y|A=a, L=l]\\Pr[L=l]\\]\nWe need not estimate \\(\\Pr(L = l)\\). Rather obtain the weighted mean for the distribution of the confounders in the data by taking the double expectation: (Hernan and Robins 2023, 166).\n\\[ATE = E[E(Y|A = a, \\boldsymbol{L}) - E(Y|A = a*, \\boldsymbol{L})]\\]\nTo obtain marginal contrasts for the expected outcomes for the entire population we use the stdReg package in R (Sjölander 2016)"
  },
  {
    "objectID": "posts/g-computation/g-computation.html#the-steps-for-g-computation",
    "href": "posts/g-computation/g-computation.html#the-steps-for-g-computation",
    "title": "Parametric G-computation in NZAVS Studies",
    "section": "The steps for G-computation",
    "text": "The steps for G-computation\n\nFirst we fit a regression for each outcome on the exposure \\(A\\_{t0}\\) and baseline covariates\\(\\boldsymbol{L} = (L_1, L_2,L_3 \\dots L_n)\\). To avoid implausible assumptions of linearity we model the relationship between the exposure each of the potential outcomes of interest using a cubic spline.  We include in the set of baseline confounders \\(\\boldsymbol{L}\\) the baseline measure of the exposure as well as the baseline response (or responses):\n\n\\[\\{A\\_{t-1}, \\boldsymbol{Y_{t-1}} = (Y_{1, t-1}, Y_{2, t-1}, Y_{3, t-1}\\dots Y_{n, t-1})\\} \\subset \\boldsymbol{L}\\]  \nThis gives us\n\\[E(Y|A, \\boldsymbol{L})\\]\n\nSecond, we use the model in (1) to predict the values of a potential outcome \\(Y^{a}\\) by setting the exposure to the value \\(A = a\\).\n\nThis gives us\n\\[\\hat{E}(Y|A = a, \\boldsymbol{L})\\]\n\nThird, we use the model in (1) to predict the values of a different potential outcome \\(Y^{a*}\\)by setting the exposure to a different value of \\(A =a^{\\star}\\).\n\nThis gives us \n\\[\\hat{E}(Y|A = a*,\\boldsymbol{L})\\]\n\nForth we obtain the focal contrast as the expected difference in the expected average outcomes when exposure at levels \\(a*\\) and \\(a\\). Where outcomes are continuous we calculate both mean of \\(Y^a\\) and the mean of  \\(Y^{a*}\\) and then obtain their difference.  This gives us: \n\n\\[\\hat{ATE} = \\hat{E}[\\hat{E}(Y|A = a, \\boldsymbol{L}) - \\hat{E}(Y|A = a*, \\boldsymbol{L})]\\]\n\nWhere outcomes are binary, we calculate the causal risk ratio in moving between the different levels of A. Where binary outcomes are more common than 10% we use a log-normal model to calculate a causal rate ratio (VanderWeele, Mathur, and Chen 2020). \nThe stdReg package in R calculates standard errors using the Delta method from which we construct confidence intervals under asymptotic assumptions(Sjölander 2016). Additionally, we pool uncertainty arising from the multiple imputation procedure by employing Rubin’s Rules."
  },
  {
    "objectID": "posts/g-computation/g-computation.html#applications",
    "href": "posts/g-computation/g-computation.html#applications",
    "title": "Parametric G-computation in NZAVS Studies",
    "section": "Applications",
    "text": "Applications\nSee upcoming “Outcome-wide science” reports for illustrations of how we apply G-computation to NZAVS studies.\n\nAcknowledgements\nWe are grateful to Arvid Sjölander for his help in modifying his stdReg package in R to enable G-computation with multiply-imputed datasets.\nFor a simple visual guide to G-computation see Kat Hoffman’s blog"
  },
  {
    "objectID": "posts/confounder-treatment-feedback/conf-out-feedback.html#purpose",
    "href": "posts/confounder-treatment-feedback/conf-out-feedback.html#purpose",
    "title": "On the Problem of Treatement Confounder Feedback",
    "section": "Purpose",
    "text": "Purpose\nCausation occurs in time. Therefore, investigating the relationship between cause and effect requires time series data.\nCausality is also dynamic. Where there is Treatment-Confounder Feedback, the relationship between cause and effect cannot be identified using standard regression methods, including multi-level regression and structural equation models. Instead, special methods - “G-methods” - are needed.\nHere, I use three causal graphs to describe a problem of treatment-confounder feedback, and direct readers to G-methods for its solution."
  },
  {
    "objectID": "posts/confounder-treatment-feedback/conf-out-feedback.html#my-assumptions-about-you",
    "href": "posts/confounder-treatment-feedback/conf-out-feedback.html#my-assumptions-about-you",
    "title": "On the Problem of Treatement Confounder Feedback",
    "section": "My assumptions about you",
    "text": "My assumptions about you\n\nYou are interested in psychological science.\nYou understand how to read causal graphs 1\nYour “go-to” method for time-series analysis is either a latent growth curve or a multi-level model."
  },
  {
    "objectID": "posts/confounder-treatment-feedback/conf-out-feedback.html#confounding-by-common-cause",
    "href": "posts/confounder-treatment-feedback/conf-out-feedback.html#confounding-by-common-cause",
    "title": "On the Problem of Treatement Confounder Feedback",
    "section": "Confounding by Common Cause",
    "text": "Confounding by Common Cause\nSuppose we wish to compute the causal effect of treatment \\(A\\) on outcome \\(Y\\). Because \\(L\\) is a common cause of both \\(A\\) and \\(Y\\), \\(L\\) will lead to an association between \\(A\\) and \\(Y\\). We face confounding by common cause. The good news: where \\(L\\) is measured, a regression model that conditions on \\(L\\) will break the association between \\(A\\) and \\(Y\\). Again, causation occurs in time. We index measured nodes to ensure our data adhere to time’s arrow\n\n\nreveal code\n\\begin{tikzpicture}[squarednode/.style={rectangle, draw=gray!90, fill=gray!5, auto}]\n\\tikzset{>=latex}\n\\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]\n\\tikzstyle{DoubleArrow} = [-, preaction = {decorate}]\n\\node[squarednode] (1) {$L_{t-1}$};\n\\node[right =of 1] (2) {$A_{t}$};\n\\node[right =of 2] (3) {$Y_{t+1}$};\n\\draw[Arrow,bend left] (1) to (3);\n\\draw[Arrow] (1) to (2);"
  },
  {
    "objectID": "posts/confounder-treatment-feedback/conf-out-feedback.html#confounding-by-over-conditioning",
    "href": "posts/confounder-treatment-feedback/conf-out-feedback.html#confounding-by-over-conditioning",
    "title": "On the Problem of Treatement Confounder Feedback",
    "section": "Confounding by Over-Conditioning",
    "text": "Confounding by Over-Conditioning\nSuppose \\(L_{t+1}\\) is an effect of \\(A_{t}\\). To condition on the common effect will induce a spurious association between \\(A_t\\) and \\(Y_{t+1}\\) through the unmeasured confounder \\(U\\) (red path). We may avoid this problem by excluding \\(L_{t+1}\\) from our regression model. To know whether exclusion is warranted requires indexing the relative occurrences of \\(A\\) and \\(L\\). However, without time-series data, we cannot generally know whether \\(L\\) is a cause of \\(A\\) or its effect. Figures 1 and 2 illustrate the importance of collecting time-series data to infer causality. Although psychological scientists are familiar with adjustment by regression to address confounding by common cause, we are less familiar with the hazards of over-conditioning. Generally, confounding control in any observational science requires time series data.\n\n\nreveal code\n\\begin{tikzpicture}[squarednode/.style={rectangle, draw=red!60, fill=red!5}, scale = 4]\n\\tikzset{>=latex}\n\\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]\n\\tikzstyle{DoubleArrow} = [-, dotted, preaction = {decorate}]\n\\node[] (0) {$U$};\n\\node[ below =of 0] (1) {$A_t$};\n\\node[squarednode, right =of 1] (2) {$L_{t+1}$};\n\\node[right =of 2] (3) {$Y_{t+1}$};\n\\draw[Arrow,bend left=25, red] (0) to (3);\n\\draw[Arrow] (0) to (2);\n\\draw[Arrow] (1) to (2);\n\\draw[DoubleArrow, bend right=20, red] (0) to (1);"
  },
  {
    "objectID": "posts/confounder-treatment-feedback/conf-out-feedback.html#confounding-control-for-treatment-confounder-feedback-damned-if-you-condition-damned-if-you-do-not.",
    "href": "posts/confounder-treatment-feedback/conf-out-feedback.html#confounding-control-for-treatment-confounder-feedback-damned-if-you-condition-damned-if-you-do-not.",
    "title": "On the Problem of Treatement Confounder Feedback",
    "section": "Confounding control for Treatment-Confounder Feedback: Damned if you condition damned if you do not.",
    "text": "Confounding control for Treatment-Confounder Feedback: Damned if you condition damned if you do not.\nSuppose we collect time series data. Suppose further that conditioning on \\(L\\) blocks an unmeasured common cause \\(U\\) of future treatments \\(A\\) and future outcomes \\(Y\\). Suppose further, as in Figure 2, past states of \\(A\\) affect future states of \\(L\\). Notice, regression faces a damned-if-we-do-damned-if-we-don’t adjustment challenge. On the one hand, to avoid confounding by a common cause we must adjust for \\(L\\) at all time points. On the other hand, adjusting for \\(L_{t+1}\\) induces confounding by over-conditioning (paths in red). **Regression, including multi-level regression and structural equation models, must be abandoned.* There are alternatives to regression called G-methods that may address treatment-confounder feedback. One of these methods, the Marginal Structural Model, replaces \\(L\\) with inverse probability weights for the exposure. G-methods are described in Chapters 12 and 13 of Hernan and Robin’s[Hernan and Robins (2023)]2\n\nHernan, M. A., and J. M. Robins. 2023. Causal Inference. Chapman & Hall/CRC Monographs on Statistics & Applied Probab. Taylor & Francis. https://books.google.co.nz/books?id=\\_KnHIAAACAAJ.\n\n\nreveal code\n\\begin{tikzpicture}[squarednode/.style={rectangle, draw=red!60, fill=red!5}, scale = 4]\n\\tikzset{>=latex}\n\\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]\n\\tikzstyle{DoubleArrow} = [-, thick, dotted, preaction = {decorate}]\n\n\\node[draw=black, thick] (1) {L$_{t-1}$};\n\\node[right =of 1] (2) {A$_{t}$};\n\\node[right =of 2] (3) {Y$_{t+1}$};\n\\node[squarednode, right =of 3] (4) {L$_{t+1}$};\n\\node[right =of 4] (5) {A$_{t+1}$};\n\\node[right =of 5] (6) {Y$_{t+2}$};\n\\node[left =of 1] (7) {U};\n\\draw[Arrow] (1) -- (2);\n\\draw[Arrow] (4) -- (5);\n\\draw[Arrow] (7) to (1);\n\\draw[DoubleArrow, red, bend left=40] (2) to (6);\n\\draw[Arrow, bend right, red] (7) to (6);\n\\draw[Arrow, bend right, red] (7) to (4);\n\\draw[Arrow, bend right] (7) to (3);\n\\draw[Arrow, bend left, red] (2) to (4);"
  },
  {
    "objectID": "posts/confounder-treatment-feedback/conf-out-feedback.html#importance",
    "href": "posts/confounder-treatment-feedback/conf-out-feedback.html#importance",
    "title": "On the Problem of Treatement Confounder Feedback",
    "section": "Importance",
    "text": "Importance\nI write this report to encourage psychological scientists to (1) collect time-series data and (2) address treatment-confounder feedback by employing G-methods. I do not write this report to cast stones. My published work offers ample illustrations of the problems that I describe here. On a positive note, a causal revolution in psychological science is upon us. Our best science remains ahead of us (VanderWeele 2015).\n\nVanderWeele, Tyler. 2015. Explanation in Causal Inference: Methods for Mediation and Interaction. Oxford University Press."
  },
  {
    "objectID": "posts/confounder-treatment-feedback/conf-out-feedback.html#references",
    "href": "posts/confounder-treatment-feedback/conf-out-feedback.html#references",
    "title": "On the Problem of Treatement Confounder Feedback",
    "section": "References",
    "text": "References"
  },
  {
    "objectID": "posts/welcome/index.html#me",
    "href": "posts/welcome/index.html#me",
    "title": "Welcome to the B-causal Lab",
    "section": "Me",
    "text": "Me\nHello. My name is Joseph Bulbulia. I am a Professor of Psychology at Victoria University of Wellington, a member of the New Zealand Attitudes and Values Senior Leadership Team, a research associate at the Max Plank Institute for the Science of Human History, and an adjunct professor in Psychology at the University of Canterbury.\nA CV with links to my publications can be found by clicking the “CV” button here"
  },
  {
    "objectID": "posts/welcome/index.html#purpose",
    "href": "posts/welcome/index.html#purpose",
    "title": "Welcome to the B-causal Lab",
    "section": "Purpose",
    "text": "Purpose\nThe purpose of this site is to convey brief research reports to the public. The reports relate to substantive research from the the New Zealand Attitudes and Values Study and to methods for causal inference using panel data."
  },
  {
    "objectID": "posts/welcome/index.html#contact",
    "href": "posts/welcome/index.html#contact",
    "title": "Welcome to the B-causal Lab",
    "section": "Contact",
    "text": "Contact\nMy email address for contact is: joseph.bulbulia@vuw.ac.nz"
  },
  {
    "objectID": "posts/nzavs/index.html",
    "href": "posts/nzavs/index.html",
    "title": "The New Zealand Attitudes and Values Study",
    "section": "",
    "text": "Show the code\n# read data\ndat <- readRDS(pull_path)\n\ndatrep <- dat %>%\n  dplyr::mutate(timeline = make_date(year = 2009, month = 6, day = 30) + TSCORE) %>%\n  count(day = floor_date(timeline, \"day\")) %>%\n  dplyr::mutate(Year = factor(ifelse(\n    day < \"2010-01-01\",\n    2009,\n    ifelse(\n      day < \"2011-01-01\",\n      2010,\n      ifelse(\n        day < \"2012-01-01\",\n        2011,\n        ifelse(\n          day < \"2013-01-01\",\n          2012,\n          ifelse(\n            day < \"2014-01-01\",\n            2013,\n            ifelse(\n              day < \"2015-01-01\",\n              2014,\n              ifelse(\n                day < \"2016-01-01\",\n                2015,\n                ifelse(\n                  day < \"2017-01-01\",\n                  2016,\n                  ifelse(\n                    day < \"2018-01-01\",\n                    2017,\n                    ifelse(day < \"2019-01-01\", 2018,\n                           ifelse(day < \"2020-01-01\", 2019, \n                                   ifelse(day < \"2021-01-01\", 2020, \n                                             ifelse(day < \"2022-01-01\", 2021,2022))\n                  )\n                )\n              )\n            )\n          )\n        )\n      )\n    )\n  ))) ))%>%\n  arrange(day)\n\n# create date lines\nceq <- as.Date(\"2011-02-22\")\nkeq <- as.Date(\"2016-11-14\")\nter <- as.Date(\"2019-03-15\")\ncov <- as.Date(\"2020-03-24\")\n\n# get number for dates\nceqD <- which(datrep$day %in% ceq)\nkeqD <- which(datrep$day %in% keq)\nterD <- which(datrep$day %in% ter)\ncovD <- which(datrep$day %in% cov)\n\n\n# create dates\n\nd1 <- as.numeric(datrep$day[ceqD])\nd2 <- as.numeric(datrep$day[keqD])\nd3 <- as.numeric(datrep$day[terD])\nd4 <- as.numeric(datrep$day[covD])\n\n# create break points\ncuts <-\n  data.frame(\n    Big_Events = c(\n      \"Christchurch Earthquake\",\n      \"Kaikoura Earthquake\",\n      \"Mosque Attacks\",\n      \"Stringent COVID-19 LockDown\"\n    ),\n    vals = c(d1, d2, d3, d4),\n    stringsAsFactors = FALSE\n  )\n\npl_1 <- ggplot2::ggplot(datrep, aes(day, n)) +\n  geom_col(aes(fill = Year)) + scale_x_date(date_labels = \"%b/%Y\")  +\n  geom_vline(\n    mapping = aes(xintercept = vals,\n                  colour = Big_Events),\n    data = cuts,\n    linetype = \"dashed\",\n    show.legend = TRUE\n  )  +\nlabs(title = \"New Zealand Attitudes and Values Study Daily Response Counts\\n Years 2009-2020; N = 69,021\",\n     x = \"NZAVS daily counts\", y = \"Count of Responses\") + theme_classic()  +  scale_fill_viridis_d() + theme(legend.position = \"top\")\n\n#plot\npl_1 \n\nggsave(\n  pl_1,\n  path = here::here(here::here(\"posts\", \"nzavs\" )),\n  width = 8,\n  height = 4.5,\n  units = \"in\",\n  filename = \"timeline-1.png\",\n  device = \"png\",\n  scale = 1,\n  dpi = 100,\n  limitsize = TRUE\n)\n\n\n\n\n\nFigure 1: NZAVS responses by days 2009-2022."
  },
  {
    "objectID": "posts/nzavs/index.html#what-makes-the-nzavs-different",
    "href": "posts/nzavs/index.html#what-makes-the-nzavs-different",
    "title": "The New Zealand Attitudes and Values Study",
    "section": "What makes the NZAVS different?",
    "text": "What makes the NZAVS different?\nThe NZAVS is a panel study. A panel study is a longitudinal study that follows the same individuals over time. A panel study is different from a census, which samples the population as a whole over time, without tracking individuals.\nTime-series data within the same individuals across a diverse population are powerful because they enable a systematic understanding of the causal interplay between human social and psychological processes that occur within people as they respond to consequential events in our lives (“natural experiments”).\nThe NZAVS maintains an up-to-date contact list as participants move house, change names, change telephone accounts, and change email addresses. The study’s personalised telephone campaigns, holiday cards, and participant prize draws have enabled the NZAVS to maintain a remarkably high annual sample retention rate of 70-80%. (Many longitudinal studies achieve only 20% retention.)\nEach year, the NZAVS surveys health, personality, relationships, employment, values, beliefs, and habits within the same people. The study has received responses from 69,021 New Zealanders. Its most recent wave (2021/22) received longitudinal responses from over 33,000 New Zealanders. This is about 1% of New Zealand’s adult population. The NZAVS is distinct from other national panel studies for the breadth of its survey questions with broad coverage in political and social psychology, health, and religion/spirituality and for its temporal scale, which encompasses 13 longitudinal waves."
  },
  {
    "objectID": "posts/nzavs/index.html#where-can-i-go-for-futher-information",
    "href": "posts/nzavs/index.html#where-can-i-go-for-futher-information",
    "title": "The New Zealand Attitudes and Values Study",
    "section": "Where can I go for futher information?",
    "text": "Where can I go for futher information?\nThe NZAVS website is maintained by Prof Chris Sibley: Link"
  },
  {
    "objectID": "posts/nzavs/index.html#link-to-data-dictionary-and-questions",
    "href": "posts/nzavs/index.html#link-to-data-dictionary-and-questions",
    "title": "The New Zealand Attitudes and Values Study",
    "section": "Link to data dictionary and questions",
    "text": "Link to data dictionary and questions\nLink to full data dictionary\nLink to questions only"
  },
  {
    "objectID": "posts/nzavsnetwork/nzavs_network.html",
    "href": "posts/nzavsnetwork/nzavs_network.html",
    "title": "NZAVS Retention Graph",
    "section": "",
    "text": "The fundamental challenge of longitudinal research is participant retention. This graph presents sample retention for the New Zealand Attitudes and Values Study (NZAVS). Figure 1 presents the sample frames within a single graph. Figure 2 presents the sample frames separately.\nFor more information about the NZAVS see: here and here\n\n\nShow the code\n# First we import the data, and create an indicator for measured/lost/withdrawn.\nlibrary(\"ggalluvial\") # alluvial graphs\n\n# data sent by Chris Sibley Aug 2021\n\nsampling_data <-\n  haven::read_sav(here::here(\"data\", \"GraphData2.sav\"))\n\n# remove SPSS labels\nsampling_data <- haven::zap_formats(sampling_data)\nsampling_data <- haven::zap_label(sampling_data)\nsampling_data <- haven::zap_widths(sampling_data)\nsampling_data <- haven::zap_labels(sampling_data)\n\n# rename Id variable\nsampling_data <- sampling_data %>%\n  rename(Id = Questionnaire.Num)\n\n## transform data into long form, required for ggalluvial, and rename the waves\ninner_join(\n  sampling_data  %>%\n    dplyr::select(c(\n      Id,\n      c(\n        'T01',\n        \"T02\",\n        'T03',\n        \"T035\",\n        \"T04\",\n        'T05',\n        \"T06\",\n        'T07',\n        \"T08\",\n        \"T09\",\n        \"T10\",\n        \"T11\",\n        \"T12\"\n      )\n    )) %>%      #~~~~ Left side = date component ~~~~~~~~\n    gather(Wave, YearMeasured, -Id) %>%  #~ long form = 1 row per prod per seq   ~\n    mutate(\n      Wave = recode_factor(\n        Wave,\n        T01 = \"2009\",\n        T02 = \"2010\",\n        T03 = \"2011\",\n        T035 = \"2011.5\",\n        T04  = \"2012\",\n        T05 = \"2013\",\n        T06 = \"2014\",\n        T07 = \"2015\",\n        T08 = \"2016\",\n        T09 = \"2017\",\n        T10 = \"2018\",\n        T11 = \"2019\",\n        T12 = \"2020\"\n      )\n    ) %>%\n    arrange(Id),\n  sampling_data %>%\n    dplyr::select(c(Id, starts_with('SampleOriginYear'))) %>%\n    arrange(Id),\n) -> sdf\n\n# define sample origin year\nsdf <- sdf %>%\n  mutate(SampleOriginYear = SampleOriginYear + 2008)\n\n#  Make sample frame into a factor\nsdf$SampleOriginYear <- as.factor(sdf$SampleOriginYear)\n\n# Created levels for \"missing\", \"not yet measured\" and \"deceased\"\n# then filter \"not yet measured\"\n\nsdf.0 <- sdf %>%\n  mutate(Wave = as.numeric(as.character(Wave))) %>%\n  arrange(Wave, Id) %>%\n  group_by(Id) %>%\n  mutate(first = {\n    YearMeasured == 1\n  } %>% {\n    . * !duplicated(.)\n  }) %>%\n  mutate(\n    value_tmp = if_else(first == 1, Wave, NA_real_),\n    firstwave  = mean(value_tmp, na.rm = TRUE) # this is a hack, but works\n  ) %>%\n  mutate(state  = ifelse(\n    YearMeasured == -1,\n    \"deceased\",\n    ifelse(\n      YearMeasured == 0 & Wave < firstwave,\n      \"notyetmeasured\",\n      ifelse(YearMeasured == 0 &\n               Wave > firstwave, \"missing\",\n             \"measured\")\n    )\n  )) %>%\n  dplyr::mutate(Wave = as.factor(Wave)) %>% # return Wave to a factor\n  dplyr::select(Wave, Id, state, YearMeasured, SampleOriginYear) %>%\n  dplyr::filter(state != \"notyetmeasured\") %>%\n  droplevels() %>%\n  arrange(Id, Wave)\n\n# This is to create a \"recovered\" state. Not used but could be useful for modelling recovery:\nsdf.01 <- sdf.0 %>%\n  group_by(Id) %>%\n  mutate(lag_state = dplyr::lag(state, n = 1, default = \"init\"))\n\nsdf.1 <- sdf.01 %>%\n  group_by(Id, Wave) %>%\n  mutate(recovered = ifelse(lag_state == \"missing\" &\n                              state == \"measured\", \"recovered\", state))\n\n\n# We need to back fill the missing values for our alluvial graph.\n# This is OK because a participants original sampling frame does not change.\n\nssdf0 <- sdf.1 %>%  # Fill missing values for Sample.Frame\n  arrange(Id) %>%\n  group_by(Id) %>%\n  fill(SampleOriginYear)  %>%\n  ungroup()\n\n# now we create the \"state_frame\" variable\ntf <- ssdf0 %>%\n  mutate(SampleOriginYear = as.character(SampleOriginYear))\n\nssdf <- tf %>%\n  mutate(state_frame = ifelse(\n    state == \"missing\",\n    \"missing\",\n    ifelse(state == \"deceased\", \"deceased\",\n           SampleOriginYear)\n  ))\nssdf.0 <- ssdf %>%\n  mutate(state_frame = factor(state_frame))\n\n# next we order the levels of the factor to create a pretty graph\nssdf.01 <- ssdf.0 %>%\n  mutate(state_frame = forcats::fct_relevel(\n    state_frame,\n    c(\n      \"2009\",\n      \"2010\",\n      \"2011\",\n      \"2011.5\",\n      \"2012\",\n      \"2013\",\n      \"2014\",\n      \"2015\",\n      \"2016\",\n      \"2017\",\n      \"2018\",\n      \"2019\",\n      \"2020\",\n      \"missing\",\n      \"deceased\"\n    )\n  )) %>%\n  rename(Recovered = recovered) # for pretty table"
  },
  {
    "objectID": "posts/nzavsnetwork/nzavs_network.html#alluvial-graph-nzavs-sample-retention-by-wave-faceted-by-sample-frame",
    "href": "posts/nzavsnetwork/nzavs_network.html#alluvial-graph-nzavs-sample-retention-by-wave-faceted-by-sample-frame",
    "title": "NZAVS Retention Graph",
    "section": "Alluvial graph: NZAVS sample retention by wave, faceted by sample frame",
    "text": "Alluvial graph: NZAVS sample retention by wave, faceted by sample frame\n\n\nShow the code\n# prepare data for graph \ndatsSF <- ssdf.01 %>%\n  group_by(Wave, state_frame, Id) %>%\n  summarise(n = n())\n\n# Graph\n\np <- ggplot(\n  datsSF,\n  aes(\n    x = Wave,\n    stratum = state_frame,\n    alluvium = Id,\n    y = n,\n    fill = state_frame,\n    label = state_frame\n  )\n) +\n  geom_flow() +\n  geom_stratum(alpha = .5) +\n  geom_text(stat = \"stratum\", size = 2) +\n  guides(color = guide_legend(override.aes = list(size = 20))) +\n  scale_x_discrete(position = 'top', expand = c(0, 0)) +\n  scale_y_reverse(\n    expand = c(0.001, 0.001),\n    minor_breaks = seq(0, 70000, by = 1000),\n    breaks = seq(0, 70000, by = 5000)\n  ) +\n  scale_fill_viridis_d(option = \"turbo\") +\n  ggtitle(\"NZAVS alluvial retention graph: waves 2009-2020\")  +\n  theme_bw() +   \n  theme(legend.justification = \"top\") +\n  theme(legend.title = element_blank())  # remove legend title\n\n# to save file in your directory at correct resolution, uncomment below\n# file <- here(\"figs\", paste(\"alluvial_highres_turbo_BW\", \".png\", sep = \"\"))\n\np\n\nggsave(\n  p,\n  path = here::here(here::here(\"posts\", \"nzavsnetwork\" )),\n  width = 8,\n  height = 4.5,\n  units = \"in\",\n  filename = \"a_plot.png\",\n  device = \"png\",\n  scale = 1,\n  dpi = 100,\n  limitsize = TRUE\n)\n\n\n\n\n\nFigure 1: NZAVS alluvial retention graph: waves 2009-2020.\n\n\n\n\n\n\nShow the code\n# prepare data\ndatsSS <- ssdf.01 %>%\n  group_by(Wave, state, SampleOriginYear, Id) %>%\n  summarise(n = n())\n\n\n# Graph\nggplot(datsSS,\n       aes(\n         x = Wave,\n         stratum = state,\n         alluvium = Id,\n         y = n,\n         fill = state,\n         label = state\n       )) +\n  scale_x_discrete(expand = c(.1, .1)) +\n  geom_flow() +\n  geom_stratum(alpha = .5) +\n  geom_text(stat = \"stratum\", size = 2) +\n  theme(legend.position = \"none\") +\n  scale_x_discrete(position = 'top') +\n  scale_y_reverse(\n    expand = c(0.001, 0.001),\n    minor_breaks = seq(0, 70000, by = 1000),\n    breaks = seq(0, 70000, by = 1000)\n  ) +\n  facet_grid(SampleOriginYear ~ ., scales = \"free\", space = \"free\") +\n  theme(strip.text.y = element_text(angle = 0)) +\n  scale_fill_viridis_d(option = \"viridis\") +\n  # scale_fill_viridis_d(option=\"turbo\") + # another option\n  ggtitle(\"NZAVS alluvial retention graph: waves 2009-2020\",\n          subtitle  = \"Facets are sample frames\")  +\n  theme_bw() +\n  theme(legend.title = element_blank())  # remove legend title\n\n\n\n\n\nFigure 2: NZAVS alluvial retention graph: facets are sample frames."
  },
  {
    "objectID": "posts/outcomewide/outcome-wide.html",
    "href": "posts/outcomewide/outcome-wide.html",
    "title": "Outcome-wide Science in NZAVS Studies",
    "section": "",
    "text": "Figure 1: Confounding control using three waves of data & multiple imputation of responses lost-to-follow-up\n\n\n\n\nConfounding occurs when the statistical association between indicators in the data do not reflect a causal association between parameters in a target population. A causal graph is a qualitative tool that enables us to quickly inspect sources of confounding.\nWe may represent our strategy for confounding control using the causal graph presented in Figure 1.\nWe define an exposure or treatment by $A$. We define \\(\\boldsymbol{Y}\\) as the set of all well-being outcomes contained in the NZAVS. Our interest is in consistently estimating the causal effect of congregation size on each of these outcomes. To consistently estimate the causal effect of an exposure \\(A=1\\) on the vector of well-being outcomes \\(\\boldsymbol{Y}\\) we must ensure that we have included a set of confounders that will prevent any statistical association between \\(A\\) and \\(Y\\) in the absence of causation. A statistical association in the absence of a causal association may arise in one of three ways.: (1) \\(A\\) and \\(Y\\) share a common cause. (2) \\(A\\) and \\(Y\\) share a common effect. (3) There is confounding by descent, such that conditioning on a confounder introduces a statistical association between \\(A\\) and \\(Y\\) in the absence of a casual association (collider bias).\nTo address challenge (1) we may condition or stratify on all measured common causes of \\(A\\) and \\(Y\\). To address challenges (2) and (3), we must not condition on any effect or desendent of an effect. Note however that by conditioning on a descent of a common cause we may at least partially address conditioning by a common cause. This is because conditioning on the effect of a common cause may itself partially block the effect of the that common cause.\nIn NZAVS outcome-wide science studies we use a modified version of VanderWeele et al’s approach for estimating outcome-wide causal effects (VanderWeele, Mathur, and Chen 2020).\nVanderWeele’s approach utilises three waves of panel data collected within the same participants over time.\nCall \\(t-1\\) the baseline wave, \\(t_0\\) the exposure wave, and \\(t+1\\) the outcome measurement wave. First, we include at baseline indicators of all past outcomes \\(\\boldsymbol{Y}_{t-1}\\). Second, we include at baseline an indicator for the past exposure \\(A_{t-1}\\). Third, we include a rich set of baseline confounders \\(\\boldsymbol{L_{t-1}}\\). Of course, we cannot ensure that this strategy is sufficient to ensure no unmeasured confounding. However, on On VanderWeele’s strategy, for any unmeasured confounder to affect both the exposure/outcome association, it would need to do so independently of its effects on prior measurements of the exposure and (all) outcomes at baseline, in addition to all measured baseline confounders. Note also that by controlling for measured confounders the wave prior to exposure we avoid unwittingly conditioning on an effects of the exposure that subsequently affects the outcome – mediator bias. Note furthermore that by measuring the outcome in the year following the exposure, \\(Y_{t+1}\\), we ensure that the exposure temporally precedes the outcome, and is not, for example, an effect of the outcome. Finally, loss-to-follow-up or attrition, as well as survey non-response may introduce selection bias (represented by the boxed \\(S_{t+1}\\)). There are several ways in which uch selection bias may introduce confounding. In Figure 1, we note the prospect in which a novel common cause of \\(A\\) and \\(Y\\) called \\(U_s\\) may lead to a spurious association between \\(A\\) and \\(Y\\) if \\(S\\) is a collider of \\(A\\) and \\(U_s\\). To avoid selection bias we multiply impute the missing responses.\n\n\n\n\nReferences\n\nVanderWeele, Tyler J, Maya B Mathur, and Ying Chen. 2020. “Outcome-Wide Longitudinal Designs for Causal Inference: A New Template for Empirical Studies.” Statistical Science 35 (3): 437466.\n\nReuseCC BY-NC-SACitationBibTeX citation:@online{bulbulia2022,\n  author = {Joseph Bulbulia},\n  title = {Outcome-Wide {Science} in {NZAVS} {Studies}},\n  date = {2022-11-05},\n  url = {https://go-bayes.github.io/b-causal-lab/},\n  langid = {en}\n}\nFor attribution, please cite this work as:\nJoseph Bulbulia. 2022. “Outcome-Wide Science in NZAVS\nStudies.” November 5, 2022. https://go-bayes.github.io/b-causal-lab/."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "B-causal-Lab",
    "section": "",
    "text": "On the Problem of Treatement Confounder Feedback\n\n\n\n\n\n\n\nCausal Inference\n\n\nDAG\n\n\nMethods\n\n\n\n\n\n\n\n\n\n\n\nNov 6, 2022\n\n\nJoseph Bulbulia\n\n\n\n\n\n\n  \n\n\n\n\nParametric G-computation in NZAVS Studies\n\n\n\n\n\n\n\nCausal Inference\n\n\nNZAVS\n\n\nMethods\n\n\n\n\n\n\n\n\n\n\n\nNov 5, 2022\n\n\nJoseph Bulbulia\n\n\n\n\n\n\n  \n\n\n\n\nOutcome-wide Science in NZAVS Studies\n\n\n\n\n\n\n\nCausal Inference\n\n\nNZAVS\n\n\nOutcome-wide Science\n\n\nMethods\n\n\n\n\n\n\n\n\n\n\n\nNov 5, 2022\n\n\nJoseph Bulbulia\n\n\n\n\n\n\n  \n\n\n\n\nNZAVS Retention Graph\n\n\n\n\n\n\n\nBackground\n\n\nNZAVS\n\n\n\n\n\n\n\n\n\n\n\nNov 4, 2022\n\n\nJoseph Bulbulia, Joseph Bulbulia\n\n\n\n\n\n\n  \n\n\n\n\nThe New Zealand Attitudes and Values Study\n\n\n\n\n\n\n\nBackground\n\n\nNZAVS\n\n\n\n\n\n\n\n\n\n\n\nNov 2, 2022\n\n\nJoseph Bulbulia\n\n\n\n\n\n\n  \n\n\n\n\nWelcome to the B-causal Lab\n\n\n\n\n\n\n\nBackground\n\n\nLab\n\n\n\n\n\n\n\n\n\n\n\nOct 30, 2022\n\n\nJoseph Bulbulia\n\n\n\n\n\n\nNo matching items\n\nReuseCC BY-NC-SA"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "The purpose of this site is to convey B-causal Lab research to a broader public."
  },
  {
    "objectID": "about.html#contact",
    "href": "about.html#contact",
    "title": "About",
    "section": "Contact",
    "text": "Contact\nMy email address for contact is: joseph.bulbulia@vuw.ac.nz"
  }
]